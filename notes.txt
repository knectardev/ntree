here is state of app - but I'd like to introduce some kind of controls that allow me to build up the musical structures more systematically. e.g. if we introduce a new scale type (e.g. Raag), I'd like to be able to hear it cleanly with no modifications, e.g. minimal ascending descending scales instead of any "creative" modulation of the melodically. And, simple arpeggiation. And for the bass line, an option to simply play the root notes for each chord in the progression. And then from there, more systematically introduce variances, starting with simple patterns, and then increasing the complexity of the patterns while maintaining the "scale type" constraints.

I am describing a **"Hierarchical Composition Layer."** Instead of the AI trying to be "creative" all at once, you are building a ladder of complexity where each rung is a more advanced version of the previous one.

By starting with a "Pure" or "Naked" mode, you can verify that your scale intervals (like the specific flats/sharps of a Raag) are mathematically correct before adding the "dancing" behavior.

---

## The "Composition Building Blocks" Framework

I recommend framing this to Cursor as a **"Complexity Tier" system**. This replaces the current messy "randomness" with a structured hierarchy.

### Tier 0: The "Naked" Mode (Ground Truth)

* **Melody:** Pure ascending/descending runs between the Low and High target. No skips.
* **Bass:** Steady root-notes of the current chord progression.
* **Purpose:** To hear the "Scale/Raag" cleanly and verify "Wick-Hugging."

### Tier 1: Patterned Stability

* **Melody:** Introduction of simple 4-note "cells" (e.g., 1-2-3-1 or 1-3-2-4).
* **Bass:** Simple Root-to-Fifth pulses.

### Tier 2: Stochastic Modulation

* **Melody:** Adds the "Creative" layerâ€”ornaments, enclosures, and "Meend" (slides).
* **Bass:** Walking bass lines with chromatic approach notes.

---

## Technical Instructions for Cursor

You can provide this summary to Cursor to begin the refactor. It targets the "Conductor" logic you need.

> **Task: Implement a "Hierarchical Composition Layer"**
> **1. The Complexity Toggle (UI):**
> Add a new dropdown or slider labeled **"Melodic Tier"** with three settings:
> * **Naked (Tier 0):** Pure scale runs and root-note bass.
> * **Structured (Tier 1):** Patterned cells and arpeggiation.
> * **Dynamic (Tier 2):** Full stochastic modulation (the current complex behavior).
> 
> 
> **2. The "Naked" Sequencer:**
> Inside `processSubStep`, if Tier 0 is active:
> * **Melody:** Calculate the shortest scale path between `lastNote` and `wickTarget`. Move exactly 1 scale degree per step. No skips, no chromaticism.
> * **Bass:** Query `CHORD_MAPS` for the current `subStepCounter`. Trigger only the Root note on the downbeat (step 0, 4, 8, 12).
> 
> 
> **3. Systematic Variance:**
> Create a function `applyVariance(baseNote, tierLevel)`.
> * If **Tier 1**, allow the `baseNote` to be replaced by a 4-note arpeggio cell.
> * If **Tier 2**, apply the "Genre Complexity" logic (Jazz enclosures, Raag slides).
> 
> 
> **4. Constraint Enforcement:**
> Ensure that regardless of the Tier, every note is passed through a strict `validateScaleDegree()` function that forces the note into the current **Genre Scale** (e.g., Yaman, Dorian). No "free" notes allowed unless the Tier is set to 'Experimental/Chromatic'.

---

## Why this approach is superior:

1. **Debugging:** If the "Yaman Raag" sounds "off," you switch to Tier 0. If it still sounds off, you know your scale interval array is wrong.
2. **User Experience:** Beginners can start with a "Naked" view to understand the data-to-audio link, while advanced users can dial up the "Jazz" complexity.
3. **The "Sitar" effect:** For Indian Raags, the Tier 0 "Naked" mode will sound like a formal *Arohana/Avarohana* (scale exercise), which is a legitimate musical tradition in itself.

